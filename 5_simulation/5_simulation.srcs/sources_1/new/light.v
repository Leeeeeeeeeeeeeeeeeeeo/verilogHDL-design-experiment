module flowing_led_sim(
    input clk,          // 系统时钟 (W5)
    input rst,          // 异步复位 (SW5)
    output reg [15:0] led // 16个LED输出
);

// 仿真用分频参数：将1秒缩短为10个时钟周期
parameter SIM_DIV_MAX = 9;  // 10个周期计数 (0-9)

// 分频计数器
reg [3:0] div_counter;      // 4位计数器足够
reg clk_100ns_en;           // 100ns使能信号 (替代1秒)

// 主状态计数器 (0-63)
reg [5:0] main_counter;

// 分频器：产生100ns使能信号 (仿真用)
always @(posedge clk or posedge rst) begin
    if (rst) begin
        div_counter <= 0;
        clk_100ns_en <= 0;
    end else begin
        if (div_counter == SIM_DIV_MAX) begin
            div_counter <= 0;
            clk_100ns_en <= 1;
        end else begin
            div_counter <= div_counter + 1;
            clk_100ns_en <= 0;
        end
    end
end

// 主状态计数器
always @(posedge clk or posedge rst) begin
    if (rst) begin
        main_counter <= 0;
    end else if (clk_100ns_en) begin
        if (main_counter == 6'd63) begin
            main_counter <= 0; // 循环
        end else begin
            main_counter <= main_counter + 1;
        end
    end
end

// LED输出逻辑 (与原始设计相同)
always @(posedge clk or posedge rst) begin
    if (rst) begin
        led <= 16'b0; // 复位时所有LED灭
    end else begin
        case (main_counter)
            // 状态1: 奇偶闪烁4次 (0-7个周期)
            6'd0, 6'd2, 6'd4, 6'd6: led <= 16'b1010_1010_1010_1010;
            6'd1, 6'd3, 6'd5, 6'd7: led <= 16'b0101_0101_0101_0101;
            
            // 状态2: 从右到左依次点亮 (8-23个周期)
            6'd8: led <= 16'b0000_0000_0000_0001;
            6'd9: led <= 16'b0000_0000_0000_0011;
            6'd10: led <= 16'b0000_0000_0000_0111;
            6'd11: led <= 16'b0000_0000_0000_1111;
            6'd12: led <= 16'b0000_0000_0001_1111;
            6'd13: led <= 16'b0000_0000_0011_1111;
            6'd14: led <= 16'b0000_0000_0111_1111;
            6'd15: led <= 16'b0000_0000_1111_1111;
            6'd16: led <= 16'b0000_0001_1111_1111;
            6'd17: led <= 16'b0000_0011_1111_1111;
            6'd18: led <= 16'b0000_0111_1111_1111;
            6'd19: led <= 16'b0000_1111_1111_1111;
            6'd20: led <= 16'b0001_1111_1111_1111;
            6'd21: led <= 16'b0011_1111_1111_1111;
            6'd22: led <= 16'b0111_1111_1111_1111;
            6'd23: led <= 16'b1111_1111_1111_1111;
            
            // 状态3: 从左到右依次熄灭 (24-39个周期)
            6'd24: led <= 16'b0111_1111_1111_1111;
            6'd25: led <= 16'b0011_1111_1111_1111;
            6'd26: led <= 16'b0001_1111_1111_1111;
            6'd27: led <= 16'b0000_1111_1111_1111;
            6'd28: led <= 16'b0000_0111_1111_1111;
            6'd29: led <= 16'b0000_0011_1111_1111;
            6'd30: led <= 16'b0000_0001_1111_1111;
            6'd31: led <= 16'b0000_0000_1111_1111;
            6'd32: led <= 16'b0000_0000_0111_1111;
            6'd33: led <= 16'b0000_0000_0011_1111;
            6'd34: led <= 16'b0000_0000_0001_1111;
            6'd35: led <= 16'b0000_0000_0000_1111;
            6'd36: led <= 16'b0000_0000_0000_0111;
            6'd37: led <= 16'b0000_0000_0000_0011;
            6'd38: led <= 16'b0000_0000_0000_0001;
            6'd39: led <= 16'b0;
            
            // 状态4: 奇偶闪烁4次 (40-47个周期)
            6'd40, 6'd42, 6'd44, 6'd46: led <= 16'b1010_1010_1010_1010;
            6'd41, 6'd43, 6'd45, 6'd47: led <= 16'b0101_0101_0101_0101;
            
            // 状态5: 从两边到中间依次点亮 (48-55个周期)
            6'd48: led <= 16'b1000_0000_0000_0001;
            6'd49: led <= 16'b1100_0000_0000_0011;
            6'd50: led <= 16'b1110_0000_0000_0111;
            6'd51: led <= 16'b1111_0000_0000_1111;
            6'd52: led <= 16'b1111_1000_0001_1111;
            6'd53: led <= 16'b1111_1100_0011_1111;
            6'd54: led <= 16'b1111_1110_0111_1111;
            6'd55: led <= 16'b1111_1111_1111_1111;
            
            // 状态6: 从中间到两边依次熄灭 (56-63个周期)
            6'd56: led <= 16'b1111_1111_0111_1111;
            6'd57: led <= 16'b1111_1100_0011_1111;
            6'd58: led <= 16'b1111_1000_0001_1111;
            6'd59: led <= 16'b1111_0000_0000_1111;
            6'd60: led <= 16'b1110_0000_0000_0111;
            6'd61: led <= 16'b1100_0000_0000_0011;
            6'd62: led <= 16'b1000_0000_0000_0001;
            6'd63: led <= 16'b0;
            
            default: led <= 16'b0;
        endcase
    end
end

endmodule