module flowing_led(
    input clk,          // 系统时钟 (W5)
    input rst,          // 异步复位 (SW5)
    output reg [15:0] led // 16个LED输出
);

// 分频器参数：100MHz -> 1Hz (1秒周期)
parameter CLK_FREQ = 100_000_000; // 100MHz
parameter COUNT_MAX = CLK_FREQ - 1;

// 分频计数器
reg [26:0] div_counter; // 27位计数器 (2^27=134,217,728 > 100,000,000)
reg clk_1s_en;          // 1秒使能信号

// 主状态计数器 (0-63)
reg [5:0] main_counter;

// 分频器：产生1秒使能信号
always @(posedge clk or posedge rst) begin
    if (rst) begin
        div_counter <= 0;
        clk_1s_en <= 0;
    end else begin
        if (div_counter == COUNT_MAX) begin
            div_counter <= 0;
            clk_1s_en <= 1;
        end else begin
            div_counter <= div_counter + 1;
            clk_1s_en <= 0;
        end
    end
end

// 主状态计数器
always @(posedge clk or posedge rst) begin
    if (rst) begin
        main_counter <= 0;
    end else if (clk_1s_en) begin
        if (main_counter == 6'd63) begin
            main_counter <= 0; // 循环
        end else begin
            main_counter <= main_counter + 1;
        end
    end
end

// LED输出逻辑
always @(posedge clk or posedge rst) begin
    if (rst) begin
        led <= 16'b0; // 复位时所有LED灭
    end else begin
        case (main_counter)
            // 状态1: 奇偶闪烁4次 (0-7秒)
            // 奇数位亮，偶数位灭
            6'd0, 6'd2, 6'd4, 6'd6: led <= 16'b1010_1010_1010_1010;
            // 偶数位亮，奇数位灭
            6'd1, 6'd3, 6'd5, 6'd7: led <= 16'b0101_0101_0101_0101;
            
            // 状态2: 从右到左依次点亮 (8-23秒)
            6'd8: led <= 16'b0000_0000_0000_0001; // LED0亮
            6'd9: led <= 16'b0000_0000_0000_0011; // LED0-1亮
            6'd10: led <= 16'b0000_0000_0000_0111; // LED0-2亮
            6'd11: led <= 16'b0000_0000_0000_1111; // LED0-3亮
            6'd12: led <= 16'b0000_0000_0001_1111; // LED0-4亮
            6'd13: led <= 16'b0000_0000_0011_1111; // LED0-5亮
            6'd14: led <= 16'b0000_0000_0111_1111; // LED0-6亮
            6'd15: led <= 16'b0000_0000_1111_1111; // LED0-7亮
            6'd16: led <= 16'b0000_0001_1111_1111; // LED0-8亮
            6'd17: led <= 16'b0000_0011_1111_1111; // LED0-9亮
            6'd18: led <= 16'b0000_0111_1111_1111; // LED0-10亮
            6'd19: led <= 16'b0000_1111_1111_1111; // LED0-11亮
            6'd20: led <= 16'b0001_1111_1111_1111; // LED0-12亮
            6'd21: led <= 16'b0011_1111_1111_1111; // LED0-13亮
            6'd22: led <= 16'b0111_1111_1111_1111; // LED0-14亮
            6'd23: led <= 16'b1111_1111_1111_1111; // LED0-15亮（全亮）
            
            // 状态3: 从左到右依次熄灭 (24-39秒)
            6'd24: led <= 16'b0111_1111_1111_1111; // LED15灭
            6'd25: led <= 16'b0011_1111_1111_1111; // LED15-14灭
            6'd26: led <= 16'b0001_1111_1111_1111; // LED15-13灭
            6'd27: led <= 16'b0000_1111_1111_1111; // LED15-12灭
            6'd28: led <= 16'b0000_0111_1111_1111; // LED15-11灭
            6'd29: led <= 16'b0000_0011_1111_1111; // LED15-10灭
            6'd30: led <= 16'b0000_0001_1111_1111; // LED15-9灭
            6'd31: led <= 16'b0000_0000_1111_1111; // LED15-8灭
            6'd32: led <= 16'b0000_0000_0111_1111; // LED15-7灭
            6'd33: led <= 16'b0000_0000_0011_1111; // LED15-6灭
            6'd34: led <= 16'b0000_0000_0001_1111; // LED15-5灭
            6'd35: led <= 16'b0000_0000_0000_1111; // LED15-4灭
            6'd36: led <= 16'b0000_0000_0000_0111; // LED15-3灭
            6'd37: led <= 16'b0000_0000_0000_0011; // LED15-2灭
            6'd38: led <= 16'b0000_0000_0000_0001; // LED15-1灭
            6'd39: led <= 16'b0; // 全灭
            
            // 状态4: 奇偶闪烁4次 (40-47秒)
            // 奇数位亮，偶数位灭
            6'd40, 6'd42, 6'd44, 6'd46: led <= 16'b1010_1010_1010_1010;
            // 偶数位亮，奇数位灭
            6'd41, 6'd43, 6'd45, 6'd47: led <= 16'b0101_0101_0101_0101;
            
            // 状态5: 从两边到中间依次点亮 (48-55秒)
            6'd48: led <= 16'b1000_0000_0000_0001; // LED15和LED0亮
            6'd49: led <= 16'b1100_0000_0000_0011; // LED15-14和LED1-0亮
            6'd50: led <= 16'b1110_0000_0000_0111; // LED15-13和LED2-0亮
            6'd51: led <= 16'b1111_0000_0000_1111; // LED15-12和LED3-0亮
            6'd52: led <= 16'b1111_1000_0001_1111; // LED15-11和LED4-0亮
            6'd53: led <= 16'b1111_1100_0011_1111; // LED15-10和LED5-0亮
            6'd54: led <= 16'b1111_1110_0111_1111; // LED15-9和LED6-0亮
            6'd55: led <= 16'b1111_1111_1111_1111; // 全亮
            
            // 状态6: 从中间到两边依次熄灭 (56-63秒)
            6'd56: led <= 16'b1111_1111_0111_1111; // LED7和LED8灭
            6'd57: led <= 16'b1111_1100_0011_1111; // LED6-7和LED8-9灭
            6'd58: led <= 16'b1111_1000_0001_1111; // LED5-7和LED8-10灭
            6'd59: led <= 16'b1111_0000_0000_1111; // LED4-7和LED8-11灭
            6'd60: led <= 16'b1110_0000_0000_0111; // LED3-7和LED8-12灭
            6'd61: led <= 16'b1100_0000_0000_0011; // LED2-7和LED8-13灭
            6'd62: led <= 16'b1000_0000_0000_0001; // LED1-7和LED8-14灭
            6'd63: led <= 16'b0; // 全灭
            
            default: led <= 16'b0;
        endcase
    end
end

endmodule